<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="display-5 fw-bold">Nuestros Productos</h2>
            <p class="text-muted">Encuentra la mejor ropa deportiva para tu entrenamiento</p>
        </div>
    </div>

    <div class="row">
        <!-- Sidebar con filtros -->
        <div class="col-lg-3 mb-4">
            <div class="filter-sidebar">
                <h5 class="mb-3">
                    <i class="pi pi-filter"></i> Filtros
                </h5>

                <!-- Categorías -->
                <div class="filter-section mb-4">
                    <h6 class="filter-title">Categorías</h6>
                    <div class="list-group">
                        <button
                                class="list-group-item list-group-item-action"
                                [class.active]="!selectedCategory"
                                (click)="filterByCategory(null)">
                            Todas
                        </button>
                        <button
                                *ngFor="let category of categories"
                                class="list-group-item list-group-item-action"
                                [class.active]="selectedCategory?.id === category.id"
                                (click)="filterByCategory(category)">
                            {{ category.name }}
                        </button>
                    </div>
                </div>

                <!-- Búsqueda -->
                <div class="filter-section">
                    <h6 class="filter-title">Búsqueda</h6>
                    <div class="p-inputgroup">
                        <input
                                type="text"
                                pInputText
                                placeholder="Buscar producto..."
                                [(ngModel)]="searchTerm"
                                (input)="onSearch()">
                        <button pButton icon="pi pi-search"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de productos -->
        <div class="col-lg-9">
            <!-- Toolbar -->
            <div class="toolbar mb-4 d-flex justify-content-between align-items-center">
                <div class="toolbar-left">
                    <p-dropdown
                            [options]="sortOptions"
                            [(ngModel)]="sortKey"
                            (onChange)="onSortChange($event)"
                            placeholder="Ordenar por"
                            [style]="{'width': '250px'}">
                    </p-dropdown>
                </div>
                <div class="toolbar-right">
                    <p-button
                            icon="pi pi-th-large"
                            [text]="layout !== 'grid'"
                            [raised]="layout === 'grid'"
                            (onClick)="layout = 'grid'">
                    </p-button>
                    <p-button
                            icon="pi pi-list"
                            [text]="layout !== 'list'"
                            [raised]="layout === 'list'"
                            (onClick)="layout = 'list'"
                            class="ms-2">
                    </p-button>
                </div>
            </div>

            <!-- Loading -->
            <div *ngIf="loading" class="text-center py-5">
                <p-progressSpinner></p-progressSpinner>
            </div>

            <!-- No hay productos -->
            <div *ngIf="!loading && filteredProducts.length === 0" class="text-center py-5">
                <i class="pi pi-inbox" style="font-size: 3rem; color: var(--text-light);"></i>
                <p class="mt-3 text-muted">No se encontraron productos</p>
            </div>

            <!-- Vista de cuadrícula -->
            <div *ngIf="!loading && layout === 'grid'" class="row g-4">
                <div class="col-md-6 col-lg-4" *ngFor="let product of filteredProducts">
                    <p-card [header]="product.name" styleClass="product-card h-100">
                        <ng-template pTemplate="header">
                            <img [src]="product.imageUrl || 'assets/placeholder-product.jpg'"
                                 [alt]="product.name"
                                 class="product-image"
                                 (click)="viewProduct(product)"
                                 style="cursor: pointer;">
                            <p-tag
                                    *ngIf="!product.active"
                                    [value]="'Agotado'"
                                    [severity]="'danger'"
                                    class="position-absolute top-0 end-0 m-2">
                            </p-tag>
                        </ng-template>

                        <p class="product-description">{{ product.description | slice:0:80 }}...</p>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <span class="price-tag">${{ product.basePrice }}</span>
                            <p-rating [(ngModel)]="4" [readonly]="true" [cancel]="false"></p-rating>
                        </div>

                        <ng-template pTemplate="footer">
                            <div class="d-flex gap-2">
                                <button pButton
                                        label="Ver"
                                        icon="pi pi-eye"
                                        class="flex-fill p-button-outlined"
                                        (click)="viewProduct(product)"></button>
                                <button pButton
                                        icon="pi pi-shopping-cart"
                                        class="flex-fill"
                                        [disabled]="!product.active"
                                        (click)="addToCart(product)"></button>
                            </div>
                        </ng-template>
                    </p-card>
                </div>
            </div>

            <!-- Vista de lista -->
            <div *ngIf="!loading && layout === 'list'">
                <p-dataView #dv [value]="filteredProducts" [paginator]="true" [rows]="10">
                    <ng-template let-product pTemplate="listItem">
                        <div class="col-12 mb-3">
                            <div class="product-list-item p-4 border rounded">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <img [src]="product.imageUrl || 'assets/placeholder-product.jpg'"
                                             [alt]="product.name"
                                             class="w-100 rounded"
                                             (click)="viewProduct(product)"
                                             style="cursor: pointer;">
                                    </div>
                                    <div class="col-md-6">
                                        <h5>{{ product.name }}</h5>
                                        <p class="text-muted mb-2">{{ product.description }}</p>
                                        <p-rating [(ngModel)]="4" [readonly]="true" [cancel]="false"></p-rating>
                                        <div class="mt-2">
                                            <p-tag
                                                    [value]="product.active ? 'Disponible' : 'Agotado'"
                                                    [severity]="getSeverity(product)">
                                            </p-tag>
                                        </div>
                                    </div>
                                    <div class="col-md-3 text-center">
                                        <h4 class="price-tag mb-3">${{ product.basePrice }}</h4>
                                        <button pButton
                                                label="Ver Detalles"
                                                icon="pi pi-eye"
                                                class="w-100 mb-2 p-button-outlined"
                                                (click)="viewProduct(product)"></button>
                                        <button pButton
                                                label="Agregar al Carrito"
                                                icon="pi pi-shopping-cart"
                                                class="w-100"
                                                [disabled]="!product.active"
                                                (click)="addToCart(product)"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </p-dataView>
            </div>
        </div>
    </div>
</div>